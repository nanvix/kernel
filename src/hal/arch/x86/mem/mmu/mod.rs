// Copyright(c) The Maintainers of Nanvix.
// Licensed under the MIT License.

//==================================================================================================
// Imports
//==================================================================================================

use crate::klib::Alignment;
use core::arch;

//==================================================================================================
// Modules
//==================================================================================================

pub mod page_directory;
pub mod page_table;

//==================================================================================================
// Constants
//==================================================================================================

pub const PAGE_ALIGNMENT: Alignment = Alignment::Align4096;

pub const PGTAB_ALIGNMENT: Alignment = Alignment::Align4194304;

//==================================================================================================
// Standalone Functions
//==================================================================================================

pub unsafe fn load_page_directory(cr3: usize) {
    arch::asm!(
        "mov {0}, %eax",
        "mov %eax, %cr3",
        "mov %cr0, %eax",
        "or $0x80000000, %eax",
        "mov %eax, %cr0",
        in(reg) cr3,
        options(nostack, att_syntax)
    );
}
